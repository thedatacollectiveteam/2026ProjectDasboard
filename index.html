<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Collective ‚Äî 2026 Project Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&family=Archivo+Black&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --bg-dark: #0d0d0d;
            --bg-medium: #1a1a1a;
            --bg-card: #242424;
            --accent-cyan: #00ffcc;
            --accent-orange: #ff6b35;
            --accent-purple: #b565d8;
            --text-primary: #ffffff;
            --text-secondary: #8a8a8a;
            --green: #00ff88;
            --yellow: #ffd700;
            --red: #ff3366;
            --border: #2a2a2a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 30px;
        }

        header {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--accent-cyan);
        }

        .header-left {
            margin-bottom: 20px;
        }

        h1 {
            font-family: 'Archivo Black', sans-serif;
            font-size: 3.5rem;
            letter-spacing: 3px;
            color: var(--accent-cyan);
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            appearance: none;
            border: 1px solid var(--border);
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 12px 18px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--accent-cyan);
            color: var(--bg-dark);
            border-color: var(--accent-cyan);
        }

        .btn.primary {
            border-color: var(--accent-cyan);
            background: linear-gradient(135deg, rgba(0,255,204,0.2), rgba(0,255,204,0.05));
        }

        .cloud-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cloud-status.connected {
            border-color: var(--green);
            color: var(--green);
        }

        .cloud-status.disconnected {
            border-color: var(--yellow);
            color: var(--yellow);
        }

        .cloud-status .btn-mini {
            padding: 6px 10px;
            font-size: 0.7rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text-primary);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }

        .cloud-status .btn-mini:hover {
            background: var(--accent-cyan);
            color: var(--bg-dark);
            border-color: var(--accent-cyan);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 20px;
            border-left: 4px solid var(--accent-cyan);
        }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent-cyan);
        }

        .stat-subtext {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 8px;
        }

        .filters {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .filter-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        select, input {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-cyan);
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 25px;
        }

        .section-header {
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 2px;
            margin-bottom: 20px;
            color: var(--accent-orange);
            text-transform: uppercase;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .upcoming-milestones {
            display: grid;
            gap: 12px;
        }

        .milestone-item {
            background: var(--bg-dark);
            border-left: 3px solid var(--accent-purple);
            padding: 15px;
            display: grid;
            grid-template-columns: 120px 1fr 100px;
            gap: 15px;
            align-items: center;
        }

        .milestone-date {
            font-weight: 700;
            color: var(--accent-purple);
            font-size: 0.9rem;
        }

        .milestone-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .milestone-client {
            font-weight: 600;
            color: var(--text-primary);
        }

        .milestone-phase {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .milestone-status {
            padding: 4px 10px;
            font-size: 0.7rem;
            font-weight: 700;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .projects-table {
            width: 100%;
            border-collapse: collapse;
        }

        .projects-table th {
            background: var(--bg-dark);
            padding: 12px;
            text-align: left;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--border);
        }

        .projects-table td {
            padding: 15px 12px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }

        .projects-table tr {
            transition: background 0.2s ease;
        }

        .projects-table tr:hover {
            background: var(--bg-dark);
        }

        .project-name-cell {
            font-weight: 600;
            color: var(--text-primary);
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-green { background: var(--green); }
        .status-yellow { background: var(--yellow); }
        .status-red { background: var(--red); }

        .phase-badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--bg-dark);
            border: 1px solid var(--accent-cyan);
            color: var(--accent-cyan);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .phase-badge.planning { border-color: var(--text-secondary); color: var(--text-secondary); }
        .phase-badge.test1 { border-color: #4a9eff; color: #4a9eff; }
        .phase-badge.test2 { border-color: #00bfff; color: #00bfff; }
        .phase-badge.test3 { border-color: #00d4ff; color: #00d4ff; }
        .phase-badge.production { border-color: var(--accent-orange); color: var(--accent-orange); }
        .phase-badge.refresh { border-color: var(--accent-purple); color: var(--accent-purple); }
        .phase-badge.complete { border-color: var(--green); color: var(--green); }

        .team-list {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .complexity-dots {
            display: flex;
            gap: 3px;
        }

        .complexity-dot {
            width: 8px;
            height: 8px;
            background: var(--accent-cyan);
            border-radius: 50%;
        }

        .date-cell {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--accent-cyan);
            font-weight: 700;
        }

        footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .milestone-item {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Cloud Status Indicator -->
    <div class="cloud-status disconnected" id="cloudStatus">
        <span id="cloudStatusText">‚òÅÔ∏è Excel: Not Connected</span>
        <button class="btn-mini" onclick="setupExcelFile()">Setup File</button>
    </div>

    <div class="container">
        <header>
            <div class="header-left">
                <h1>DATA COLLECTIVE</h1>
                <div class="subtitle">2026 Project Dashboard // Tier 1 Import Support</div>
            </div>
            <div class="header-actions">
                <button class="btn primary" onclick="refreshData()">üîÑ Refresh Data</button>
                <button class="btn" onclick="window.print()">üñ®Ô∏è Print</button>
            </div>
        </header>

        <div class="dashboard-grid">
            <div class="sidebar">
                <div class="stat-card">
                    <div class="stat-label">Total Projects</div>
                    <div class="stat-value" id="totalProjects">-</div>
                    <div class="stat-subtext">Across 2026-2027</div>
                </div>
                
                <div class="stat-card" style="border-left-color: var(--green);">
                    <div class="stat-label">Green Status</div>
                    <div class="stat-value" id="greenCount" style="color: var(--green);">-</div>
                    <div class="stat-subtext">On track</div>
                </div>
                
                <div class="stat-card" style="border-left-color: var(--yellow);">
                    <div class="stat-label">Yellow Status</div>
                    <div class="stat-value" id="yellowCount" style="color: var(--yellow);">-</div>
                    <div class="stat-subtext">At risk</div>
                </div>
                
                <div class="stat-card" style="border-left-color: var(--red);">
                    <div class="stat-label">Red Status</div>
                    <div class="stat-value" id="redCount" style="color: var(--red);">-</div>
                    <div class="stat-subtext">Critical</div>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label class="filter-label">Status</label>
                        <select id="statusFilter">
                            <option value="">All</option>
                            <option value="Green">Green</option>
                            <option value="Yellow">Yellow</option>
                            <option value="Red">Red</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Team Member</label>
                        <select id="teamFilter">
                            <option value="">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label class="filter-label">Search</label>
                        <input type="text" id="searchInput" placeholder="Client...">
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="section">
                    <div class="section-header">‚ö° Upcoming Milestones (Next 90 Days)</div>
                    <div class="upcoming-milestones" id="upcomingMilestones">
                        <div class="loading">Click "Refresh Data" to load projects</div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-header">üìä All Projects</div>
                    <div style="overflow-x: auto;">
                        <table class="projects-table">
                            <thead>
                                <tr>
                                    <th>Client</th>
                                    <th>Status</th>
                                    <th>Current Phase</th>
                                    <th>Live Date</th>
                                    <th>Complexity</th>
                                    <th>Team</th>
                                </tr>
                            </thead>
                            <tbody id="projectsTableBody">
                                <tr>
                                    <td colspan="6" class="loading">Click "Refresh Data" to load projects</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <strong>THE DATA COLLECTIVE</strong> // bswift Tier 1 Import Support Team<br>
            Last Updated: <span id="lastUpdated">Not loaded</span>
        </footer>
    </div>

    <script>
        let excelFileHandle = null;
        let projectsData = [];
        let filteredProjects = [];

        async function setupExcelFile() {
            try {
                const [fileHandle] = await window.showOpenFilePicker({
                    types: [{
                        description: 'Excel Files',
                        accept: {
                            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],
                            'application/vnd.ms-excel': ['.xls']
                        }
                    }],
                    startIn: 'documents'
                });

                excelFileHandle = fileHandle;
                
                document.getElementById('cloudStatus').className = 'cloud-status connected';
                document.getElementById('cloudStatusText').textContent = `‚òÅÔ∏è Excel: ${fileHandle.name}`;

                localStorage.setItem('excelFileName', fileHandle.name);

                alert('‚úì Excel file connected!\n\nNow click "Refresh Data" to load your projects.');
            } catch (err) {
                if (err.name !== 'AbortError') {
                    console.error('Failed to setup file:', err);
                    alert('‚úï Failed to setup Excel file.\n\nMake sure you select the 2026_Projects.xlsx file.');
                }
            }
        }

        async function refreshData() {
            if (!excelFileHandle) {
                const setup = confirm('Excel file not setup yet.\n\nSelect your 2026_Projects.xlsx file?');
                if (setup) {
                    await setupExcelFile();
                    if (!excelFileHandle) return;
                } else {
                    return;
                }
            }

            try {
                const file = await excelFileHandle.getFile();
                const arrayBuffer = await file.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array', cellDates: true });
                
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { 
                    raw: false,
                    dateNF: 'yyyy-mm-dd'
                });

                projectsData = jsonData.map(row => ({
                    'Client Name': row['Client Name'] || '',
                    'Shard': row['Shard'] || '',
                    'Complexity': row['Complexity'] ? parseFloat(row['Complexity']) : null,
                    'Data People': row['Data People'] || '',
                    'Live Date': row['Live Date'] || null,
                    'Overall Status': row['Overall Status'] || 'Green',
                    'Red Status Reason': row['Red Status Reason'] || null,
                    'Supp SQL': row['Supp SQL'] || null,
                    'Loop Arounds': row['Loop Arounds'] || null,
                    'Test 1 Begin': row['Test 1 Begin'] || null,
                    'Test 1 End': row['Test 1 End'] || null,
                    'Test 2 Begin': row['Test 2 Begin'] || null,
                    'Test 2 End': row['Test 2 End'] || null,
                    'Test 3 Begin': row['Test 3 Begin'] || null,
                    'Test 3 End': row['Test 3 End'] || null,
                    'Production Begin': row['Production Begin'] || null,
                    'Production End': row['Production End'] || null,
                    'Refresh Begin': row['Refresh Begin'] || null,
                    'Refresh End': row['Refresh End'] || null,
                    'Modified Date': row['Modified Date'] || null
                }));

                document.getElementById('lastUpdated').textContent = new Date().toLocaleString();
                
                applyFilters();
                
                alert(`‚úì Data refreshed!\n\n${projectsData.length} projects loaded from Excel.`);
            } catch (err) {
                console.error('Failed to read Excel file:', err);
                
                if (err.name === 'NotAllowedError') {
                    excelFileHandle = null;
                    document.getElementById('cloudStatus').className = 'cloud-status disconnected';
                    document.getElementById('cloudStatusText').textContent = '‚òÅÔ∏è Excel: Permission Lost';
                    alert('‚úï Permission denied.\n\nPlease click "Setup File" again to grant access.');
                } else {
                    alert('‚úï Failed to read Excel file.\n\nError: ' + err.message);
                }
            }
        }

        function parseDate(dateString) {
            if (!dateString || dateString === 'null') return null;
            const date = new Date(dateString);
            return isNaN(date.getTime()) ? null : date;
        }

        function formatDate(dateString) {
            if (!dateString) return 'TBD';
            const date = parseDate(dateString);
            if (!date) return 'TBD';
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function parseTeamMembers(dataString) {
            if (!dataString || dataString === 'null') return [];
            return dataString.split(/[\n,]/).map(name => name.trim()).filter(name => name);
        }

        function getCurrentPhase(project) {
            const now = new Date();
            
            if (project['Refresh End'] && parseDate(project['Refresh End']) < now) {
                return { phase: 'complete', label: 'Complete' };
            }
            if (project['Refresh Begin'] && parseDate(project['Refresh Begin']) <= now) {
                return { phase: 'refresh', label: 'Refresh' };
            }
            if (project['Production End'] && parseDate(project['Production End']) < now) {
                return { phase: 'refresh', label: 'Pre-Refresh' };
            }
            if (project['Production Begin'] && parseDate(project['Production Begin']) <= now) {
                return { phase: 'production', label: 'Production' };
            }
            if (project['Test 3 Begin'] && parseDate(project['Test 3 Begin']) <= now) {
                return { phase: 'test3', label: 'Test 3' };
            }
            if (project['Test 2 Begin'] && parseDate(project['Test 2 Begin']) <= now) {
                return { phase: 'test2', label: 'Test 2' };
            }
            if (project['Test 1 Begin'] && parseDate(project['Test 1 Begin']) <= now) {
                return { phase: 'test1', label: 'Test 1' };
            }
            
            return { phase: 'planning', label: 'Planning' };
        }

        function getUpcomingMilestones() {
            const now = new Date();
            const ninetyDaysOut = new Date(now.getTime() + (90 * 24 * 60 * 60 * 1000));
            const milestones = [];

            filteredProjects.forEach(project => {
                const phases = [
                    { date: project['Test 1 Begin'], label: 'Test 1 Begins', type: 'test' },
                    { date: project['Test 1 End'], label: 'Test 1 Ends', type: 'test' },
                    { date: project['Test 2 Begin'], label: 'Test 2 Begins', type: 'test' },
                    { date: project['Test 2 End'], label: 'Test 2 Ends', type: 'test' },
                    { date: project['Test 3 Begin'], label: 'Test 3 Begins', type: 'test' },
                    { date: project['Test 3 End'], label: 'Test 3 Ends', type: 'test' },
                    { date: project['Production Begin'], label: 'Production Begins', type: 'production' },
                    { date: project['Production End'], label: 'Production Ends', type: 'production' },
                    { date: project['Refresh Begin'], label: 'Refresh Begins', type: 'refresh' },
                    { date: project['Refresh End'], label: 'Refresh Ends', type: 'refresh' },
                    { date: project['Live Date'], label: 'Go Live', type: 'live' }
                ];

                phases.forEach(phase => {
                    if (phase.date) {
                        const phaseDate = parseDate(phase.date);
                        if (phaseDate && phaseDate >= now && phaseDate <= ninetyDaysOut) {
                            milestones.push({
                                date: phaseDate,
                                dateString: phase.date,
                                client: project['Client Name'],
                                phase: phase.label,
                                status: project['Overall Status'],
                                type: phase.type
                            });
                        }
                    }
                });
            });

            return milestones.sort((a, b) => a.date - b.date);
        }

        function renderUpcomingMilestones() {
            const container = document.getElementById('upcomingMilestones');
            const milestones = getUpcomingMilestones();

            if (milestones.length === 0) {
                container.innerHTML = '<div class="no-data">No milestones in the next 90 days</div>';
                return;
            }

            container.innerHTML = milestones.map(m => `
                <div class="milestone-item">
                    <div class="milestone-date">${formatDate(m.dateString)}</div>
                    <div class="milestone-info">
                        <div class="milestone-client">${m.client}</div>
                        <div class="milestone-phase">${m.phase}</div>
                    </div>
                    <div class="milestone-status" style="background: var(--${m.status.toLowerCase()}); color: var(--bg-dark);">
                        ${m.status}
                    </div>
                </div>
            `).join('');
        }

        function renderProjectsTable() {
            const tbody = document.getElementById('projectsTableBody');
            
            if (filteredProjects.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">No projects match your filters</td></tr>';
                return;
            }

            tbody.innerHTML = filteredProjects.map(project => {
                const status = project['Overall Status'] || 'Green';
                const phase = getCurrentPhase(project);
                const teamMembers = parseTeamMembers(project['Data People']);
                const complexity = project.Complexity;

                return `
                    <tr>
                        <td class="project-name-cell">${project['Client Name']}</td>
                        <td>
                            <span class="status-indicator status-${status.toLowerCase()}"></span>
                            ${status}
                        </td>
                        <td>
                            <span class="phase-badge ${phase.phase}">${phase.label}</span>
                        </td>
                        <td class="date-cell">${formatDate(project['Live Date'])}</td>
                        <td>
                            ${complexity ? `
                                <div class="complexity-dots">
                                    ${Array(Math.floor(complexity)).fill('<div class="complexity-dot"></div>').join('')}
                                </div>
                            ` : '<span style="color: var(--text-secondary);">N/A</span>'}
                        </td>
                        <td class="team-list">
                            ${teamMembers.length > 0 ? teamMembers.join(', ') : 'Unassigned'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function updateStats() {
            document.getElementById('totalProjects').textContent = filteredProjects.length;
            document.getElementById('greenCount').textContent = filteredProjects.filter(p => p['Overall Status'] === 'Green').length;
            document.getElementById('yellowCount').textContent = filteredProjects.filter(p => p['Overall Status'] === 'Yellow').length;
            document.getElementById('redCount').textContent = filteredProjects.filter(p => p['Overall Status'] === 'Red').length;
        }

        function populateTeamFilter() {
            const allTeamMembers = new Set();
            projectsData.forEach(project => {
                const members = parseTeamMembers(project['Data People']);
                members.forEach(member => allTeamMembers.add(member));
            });

            const teamFilter = document.getElementById('teamFilter');
            teamFilter.innerHTML = '<option value="">All</option>';
            Array.from(allTeamMembers).sort().forEach(member => {
                const option = document.createElement('option');
                option.value = member;
                option.textContent = member;
                teamFilter.appendChild(option);
            });
        }

        function applyFilters() {
            if (projectsData.length === 0) return;

            const statusFilter = document.getElementById('statusFilter').value;
            const teamFilter = document.getElementById('teamFilter').value;
            const searchInput = document.getElementById('searchInput').value.toLowerCase();

            filteredProjects = projectsData.filter(project => {
                if (statusFilter && project['Overall Status'] !== statusFilter) return false;
                
                if (teamFilter) {
                    const teamMembers = parseTeamMembers(project['Data People']);
                    if (!teamMembers.includes(teamFilter)) return false;
                }
                
                if (searchInput && !project['Client Name'].toLowerCase().includes(searchInput)) return false;
                
                return true;
            });

            populateTeamFilter();
            updateStats();
            renderUpcomingMilestones();
            renderProjectsTable();
        }

        // Check if we have a saved file name
        window.addEventListener('DOMContentLoaded', () => {
            const savedFileName = localStorage.getItem('excelFileName');
            if (savedFileName) {
                document.getElementById('cloudStatus').className = 'cloud-status connected';
                document.getElementById('cloudStatusText').textContent = `‚òÅÔ∏è Excel: ${savedFileName}`;
            }

            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('teamFilter').addEventListener('change', applyFilters);
            document.getElementById('searchInput').addEventListener('input', applyFilters);
        });
    </script>
</body>
</html>
